<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Back bet calculator</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 20px;
    margin: 0;
  }
  nav {
    margin-bottom: 20px;
  }
  nav a {
    margin-right: 20px;
    font-weight: bold;
    text-decoration: none;
    color: #3366cc;
  }
  nav a:hover {
    text-decoration: underline;
  }

  h2 {
    margin-top: 0;
  }

  table {
    border-collapse: collapse;
    width: 100%;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: center;
    white-space: nowrap;
  }
  th {
    background: #eef;
  }
  input[type=number] {
    width: 90px;
    padding: 5px;
    box-sizing: border-box;
  }

  .positive {
    color: green;
  }
  .negative {
    color: red;
  }

  #comment {
    margin-top: 10px;
    font-weight: bold;
    color: green;
    text-align: center;
  }

  /* Container for each calculator with blue border */
  section.calculator {
    border: 2px solid #5dade2;
    padding: 15px;
    margin-bottom: 25px;
    border-radius: 6px;
  }

  /* Labels and inputs stacked vertically with some spacing */
  .input-group {
    margin-bottom: 15px;
  }
  .input-group label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
  }
  .input-group input[type=number] {
    width: 100%;
    max-width: 150px;
  }

  /* Highlight Stake value fields with light blue background */
  .stake-value {
    background-color: #d7e9fb;
    padding: 3px 6px;
    font-weight: bold;
    display: inline-block;
    margin-top: 5px;
    border-radius: 3px;
  }

  /* Wider columns for returns to prevent wrapping */
  #oddsTable th:nth-child(4),
  #oddsTable th:nth-child(5),
  #oddsTable td:nth-child(4),
  #oddsTable td:nth-child(5) {
    min-width: 110px;
  }

  /* Responsive styles */
  @media (max-width: 768px) {
    nav {
      display: none; /* Hide nav on mobile to simplify */
    }
    body {
      padding: 10px;
    }
  }

  /* Hide all sections by default on mobile except the active one */
  @media (max-width: 768px) {
    section.calculator {
      display: none;
    }
    section.calculator.active {
      display: block;
    }
    #backToFullViewBtn {
      display: block;
      margin-bottom: 20px;
      padding: 8px 15px;
      font-weight: bold;
      background-color: #5dade2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
  }
  #backToFullViewBtn {
    display: none;
  }

</style>
</head>
<body>

<nav>
  <a href="#backBetCalculator" onclick="return handleMobileNav(event, 'backBetCalculator')">Back bet calculator</a>
  <a href="#exactly2GoalsMarket" onclick="return handleMobileNav(event, 'exactly2GoalsMarket')">Create Exactly 2 Goals Market</a>
  <a href="#twoThreeGoalSpread" onclick="return handleMobileNav(event, 'twoThreeGoalSpread')">Create 2 and 3 Goal Spread</a>
</nav>

<button id="backToFullViewBtn" onclick="showAllSections()">Back to full view</button>

<section id="backBetCalculator" class="calculator">
  <h2>Back bet calculator</h2>
  <table id="oddsTable" aria-label="Back bet odds calculator table">
    <thead>
      <tr>
        <th>Odds</th>
        <th>Percentage</th>
        <th>Stake</th>
        <th>Single Line Return</th>
        <th>Market P/L</th>
      </tr>
    </thead>
    <tbody>
      <!-- Rows inserted by JS -->
    </tbody>
    <tfoot>
      <tr>
        <td><strong>Total Over round:</strong></td>
        <td id="totalPercentage">0%</td>
        <td colspan="3"></td>
      </tr>
    </tfoot>
  </table>
  <div id="comment"></div>
</section>

<section id="exactly2GoalsMarket" class="calculator">
  <h2>Create Exactly 2 Goals Market</h2>
  <div class="input-group">
    <label for="over15"><strong>Back - Over 1.5 Goals Odds:</strong></label>
    <input type="number" id="over15" step="0.01" min="0" />
  </div>
  <div class="input-group">
    <label for="under25"><strong>Back - Under 2.5 Goals Odds:</strong></label>
    <input type="number" id="under25" step="0.01" min="0" />
  </div>
  <div class="input-group">
    <label for="floatAmount"><strong>Float (£):</strong></label>
    <input type="number" id="floatAmount" step="0.01" min="0" />
  </div>
  <button onclick="calculateGoalsMarket('twoGoalsResults', ['2'], 'over15', 'under25', 'floatAmount')">Calculate</button>
  <div id="twoGoalsResults" style="margin-top:15px;"></div>
</section>

<section id="twoThreeGoalSpread" class="calculator">
  <h2>Create 2 and 3 Goal Spread</h2>
  <div class="input-group">
    <label for="spreadOver15"><strong>Back - Over 1.5 Goals Odds:</strong></label>
    <input type="number" id="spreadOver15" step="0.01" min="0" />
  </div>
  <div class="input-group">
    <label for="spreadUnder35"><strong>Back - Under 3.5 Goals Odds:</strong></label>
    <input type="number" id="spreadUnder35" step="0.01" min="0" />
  </div>
  <div class="input-group">
    <label for="spreadFloatAmount"><strong>Float (£):</strong></label>
    <input type="number" id="spreadFloatAmount" step="0.01" min="0" />
  </div>
  <button onclick="calculateGoalsMarket('twoThreeGoalsResults', ['2', '3'], 'spreadOver15', 'spreadUnder35', 'spreadFloatAmount')">Calculate</button>
  <div id="twoThreeGoalsResults" style="margin-top:15px;"></div>
</section>

<script>
  // Build 15 rows for back bet calculator table
  const tbody = document.querySelector('#oddsTable tbody');
  for (let i = 0; i < 15; i++) {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input type="number" step="0.01" min="0" class="oddInput" aria-label="Odds row ${i + 1}"/></td>
      <td class="percentageCell">0.00%</td>
      <td><input type="number" step="0.01" min="0" class="stakeInput" aria-label="Stake row ${i + 1}"/></td>
      <td class="returnCell">-</td>
      <td class="marketPLCell">-</td>
    `;
    tbody.appendChild(tr);
  }

  function updatePercentages() {
    const rows = tbody.querySelectorAll('tr');
    let total = 0;
    rows.forEach(row => {
      const oddInput = row.querySelector('.oddInput');
      const percentageCell = row.querySelector('.percentageCell');
      const odd = parseFloat(oddInput.value);
      let perc = 0;
      if (odd && odd > 0) {
        perc = 100 / odd;
      }
      percentageCell.textContent = perc.toFixed(2) + '%';
      total += perc;
    });
    document.getElementById('totalPercentage').textContent = total.toFixed(2) + '%';

    const comment = document.getElementById('comment');
    comment.textContent = total < 100 ? 'With these odds a profitable cash out opportunity exists' : '';
  }

  function updateReturns() {
    const rows = tbody.querySelectorAll('tr');
    let totalStake = 0;
    const stakes = [];
    rows.forEach(row => {
      const stakeInput = row.querySelector('.stakeInput');
      const stake = parseFloat(stakeInput.value) || 0;
      stakes.push(stake);
      totalStake += stake;
    });

    rows.forEach((row, i) => {
      const oddInput = row.querySelector('.oddInput');
      const returnCell = row.querySelector('.returnCell');
      const marketPLCell = row.querySelector('.marketPLCell');
      const odd = parseFloat(oddInput.value);
      const stake = stakes[i];

      if (!odd || odd <= 0) {
        returnCell.textContent = '-';
        marketPLCell.textContent = '-';
        marketPLCell.className = 'marketPLCell';
        return;
      }

      const singleReturn = stake * odd;
      const profit = singleReturn - totalStake;
      returnCell.textContent = '+£' + singleReturn.toFixed(2);
      marketPLCell.textContent = (profit >= 0 ? '+' : '-') + '£' + Math.abs(profit).toFixed(2);
      marketPLCell.className = 'marketPLCell ' + (profit >= 0 ? 'positive' : 'negative');
    });
  }

  tbody.addEventListener('input', (event) => {
    if (event.target.classList.contains('oddInput')) {
      updatePercentages();
      updateReturns();
    }
    if (event.target.classList.contains('stakeInput')) {
      updateReturns();
    }
  });

  updatePercentages();

  // Calculate functions for goals markets
  function calculateGoalsMarket(resultId, goalNumbers, overId, underId, floatId) {
    const overOdds = parseFloat(document.getElementById(overId).value) || 0;
    const underOdds = parseFloat(document.getElementById(underId).value) || 0;
    const floatAmount = parseFloat(document.getElementById(floatId).value) || 0;

    if (overOdds <= 0 || underOdds <= 0 || floatAmount <= 0) {
      document.getElementById(resultId).innerHTML = "<p style='color:red;'>Please enter positive values for all inputs.</p>";
      return;
    }

    // Calculate implied probabilities
    const overProb = 1 / overOdds;
    const underProb = 1 / underOdds;
    const totalProb = overProb + underProb;

    // Adjusted stakes
    const overStake = floatAmount * (overProb / totalProb);
    const underStake = floatAmount * (underProb / totalProb);

    // Calculate payouts and profits
    const payouts = {
      over: overStake * overOdds,
      under: underStake * underOdds
    };

    // Build output table
    let html = `<table style="width:100%; border-collapse: collapse; margin-top:10px;">
      <thead>
        <tr>
          <th>Number of Goals</th>
          <th>Profit / Loss (£)</th>
        </tr>
      </thead>
      <tbody>
    `;

    // Show profit for the specified goal numbers only (for 2 and/or 3)
    for (let goals = 0; goals <= 5; goals++) {
      let profit = 0;
      if (goalNumbers.includes(goals.toString())) {
        // Profit if goals match specified numbers = payout - total float
        if (goals === 2) {
          profit = payouts.over - floatAmount;
        } else if (goals === 3) {
          profit = payouts.under - floatAmount;
        }
      } else {
        // For other goals, loss is total float
        profit = -floatAmount;
      }

      // Display "5+" for row 5
      const goalsLabel = goals === 5 ? "5+" : goals;

      html += `<tr>
        <td>${goalsLabel}</td>
        <td style="color:${profit >= 0 ? 'green' : 'red'};">${profit >= 0 ? '+' : ''}£${profit.toFixed(2)}</td>
      </tr>`;
    }
    html += '</tbody></table>';

    document.getElementById(resultId).innerHTML = html;
  }

  // Mobile navigation handler
  function handleMobileNav(event, sectionId) {
    if (window.innerWidth <= 768) {
      event.preventDefault();
      // Hide all sections, show only selected
      document.querySelectorAll('section.calculator').forEach(sec => {
        sec.classList.remove('active');
      });
      document.getElementById(sectionId).classList.add('active');

      // Show back button
      document.getElementById('backToFullViewBtn').style.display = 'block';
      return false;
    }
    // On desktop, do normal jump
    return true;
  }

  function showAllSections() {
    document.querySelectorAll('section.calculator').forEach(sec => {
      sec.classList.add('active');
    });
    document.getElementById('backToFullViewBtn').style.display = 'none';
  }

  // On desktop, show all calculators by default
  if (window.innerWidth > 768) {
    showAllSections();
  }

</script>
</body>
</html>
