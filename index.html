<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Back bet calculator - test</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  table { border-collapse: collapse; width: 100%; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; white-space: nowrap; }
  th { background: #eef; }
  .positive { color: green; }
  .negative { color: red; }
</style>
</head>
<body>
<h2>Back bet calculator</h2>
<table id="oddsTable">
  <thead>
    <tr>
      <th>Odds</th>
      <th>Percentage</th>
      <th>Stake</th>
      <th>Single Line Return</th>
      <th>Market P/L</th>
    </tr>
  </thead>
  <tbody></tbody>
  <tfoot>
    <tr>
      <td><strong>Total Over round:</strong></td>
      <td id="totalPercentage">0%</td>
      <td colspan="3"></td>
    </tr>
  </tfoot>
</table>
<div id="comment"></div>

<script>
  // Create 15 rows with editable odds and stakes
  const tbody = document.querySelector('#oddsTable tbody');
  for (let i = 0; i < 15; i++) {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input type="number" step="0.01" min="0" class="oddInput" /></td>
      <td class="percentageCell">0.00%</td>
      <td><input type="number" step="0.01" min="0" class="stakeInput" /></td>
      <td class="returnCell">-</td>
      <td class="marketPLCell">-</td>
    `;
    tbody.appendChild(tr);
  }

  function updatePercentages() {
    const rows = tbody.querySelectorAll('tr');
    let total = 0;
    rows.forEach(row => {
      const oddInput = row.querySelector('.oddInput');
      const percentageCell = row.querySelector('.percentageCell');
      const odd = parseFloat(oddInput.value);
      let perc = 0;
      if (odd && odd > 0) {
        perc = 100 / odd;
      }
      percentageCell.textContent = perc.toFixed(2) + '%';
      total += perc;
    });
    document.getElementById('totalPercentage').textContent = total.toFixed(2) + '%';

    const comment = document.getElementById('comment');
    comment.textContent = total < 100 ? 'With these odds a profitable cash out opportunity exists' : '';
  }

  function updateReturns() {
    const rows = tbody.querySelectorAll('tr');
    let totalStake = 0;
    const stakes = [];
    rows.forEach(row => {
      const stakeInput = row.querySelector('.stakeInput');
      const stake = parseFloat(stakeInput.value) || 0;
      stakes.push(stake);
      totalStake += stake;
    });

    rows.forEach((row, i) => {
      const oddInput = row.querySelector('.oddInput');
      const returnCell = row.querySelector('.returnCell');
      const marketPLCell = row.querySelector('.marketPLCell');
      const odd = parseFloat(oddInput.value);
      const stake = stakes[i];

      if (!odd || odd <= 0) {
        returnCell.textContent = '-';
        marketPLCell.textContent = '-';
        return;
      }

      const singleReturn = stake * odd;
      const profit = singleReturn - totalStake;
      returnCell.textContent = '+£' + singleReturn.toFixed(2);
      marketPLCell.textContent = (profit >= 0 ? '+' : '-') + '£' + Math.abs(profit).toFixed(2);
      marketPLCell.className = 'marketPLCell ' + (profit >= 0 ? 'positive' : 'negative');
    });
  }

  // Attach event listeners once
  tbody.addEventListener('input', (event) => {
    if (event.target.classList.contains('oddInput')) {
      updatePercentages();
      updateReturns();
    }
    if (event.target.classList.contains('stakeInput')) {
      updateReturns();
    }
  });

  // Initialize empty table
  updatePercentages();
</script>
</body>
</html>

